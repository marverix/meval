/* meval v0.7.0 | Copyright 2020 (c) Marek Sieroci≈Ñski| https://github.com/marverix/meval/blob/master/LICENSE */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t=t||self).meval=e()}(this,function(){"use strict";function r(t){return(r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function u(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e,n){return e&&u(t.prototype,e),n&&u(t,n),t}function n(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),e&&a(t,e)}function o(t){return(o=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)})(t)}function a(t,e){return(a=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t})(t,e)}function c(t,e){return!e||"object"!=typeof e&&"function"!=typeof e?function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t):e}var e=function(){function t(){i(this,t),this.data=""}return s(t,[{key:"add",value:function(t){this.data+=t}},{key:"take",value:function(){throw new Error("Overwrite this method!")}},{key:"$pattern",get:function(){return this.constructor.$pattern}}]),t}(),h=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,e),s(t,[{key:"resolve",value:function(){return this.data}},{key:"last",get:function(){return this.data[this.data.length-1]}}]),t}(),l=-1,f=0,v=1,t=function(){function e(){var t;return i(this,e),(t=c(this,o(e).call(this))).hasDot=!1,t}return n(e,h),s(e,[{key:"take",value:function(t){if(this.$pattern.test(t))this.add(t);else{if("."!==t||this.hasDot)return l;this.add(t),this.hasDot=!0}return f}},{key:"resolve",value:function(){if("."===this.last)throw new Error("Unexpected end of the float number!");return this.hasDot?parseFloat(this.data):parseInt(this.data,10)}}]),e}();t.$pattern=/^\d/;var d=t,p=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,h),s(t,[{key:"take",value:function(t){return this.add(t),this.$pattern.test(this.data)?v:f}},{key:"resolve",value:function(){switch(this.data){case"true":return!0;case"false":return!1;default:throw new Error("Unexpected end of the boolean")}}}]),t}();p.$pattern=/^(?:true|false)/;var y=p,x=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,h),s(t,[{key:"take",value:function(t){return this.add(t),this.$pattern.test(this.data)?v:f}},{key:"resolve",value:function(){switch(this.data){case"undefined":return;case"null":return null;case"NaN":return NaN;case"Infinity":return 1/0;default:throw new Error("Unexpected end of the property")}}}]),t}();x.$pattern=/^(?:undefined|null|NaN|Infinity)/;var k=x,w=function(){function e(){var t;return i(this,e),(t=c(this,o(e).call(this))).delimiter=null,t.escape=!1,t}return n(e,h),s(e,[{key:"take",value:function(t){return null==this.delimiter?(this.delimiter=t,f):t===this.delimiter?this.escape?(this.add(this.delimiter),this.escape=!1,f):(this.delimiter=null,v):(this.escape||"\\"!==t?(this.escape&&(this.add("\\"),this.escape=!1),this.add(t)):this.escape=!0,f)}},{key:"resolve",value:function(){if(null!=this.delimiter)throw new Error("Unexpected end of the string!");return this.data}}]),e}();w.$pattern=/^['"`]/;var S=w,_=/^[$_A-Za-z0-9]/,$=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,h),s(t,[{key:"take",value:function(t){return _.test(t)?(this.add(t),f):l}},{key:"resolve",value:function(t){return t?t[this.data]:this.data}}]),t}();$.$pattern=/^[$_A-Za-z]/;var m=[d,y,k,S,$];var E={find:function(t){var e=!0,n=!1,r=void 0;try{for(var i,u=m[Symbol.iterator]();!(e=(i=u.next()).done);e=!0){var s=i.value;if(s.$pattern.test(t))return s}}catch(t){n=!0,r=t}finally{try{e||null==u.return||u.return()}finally{if(n)throw r}}return null},isConsumer:function(t){return t instanceof h}},g=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,e),s(t,[{key:"take",value:function(t){if(null==this.$pattern)throw new Error("Incorrect operator");return this.add(t),this.$pattern.test(this.data)?v:f}},{key:"execute",value:function(){throw new Error("Overwrite this method!")}},{key:"resolveSide",value:function(t,e){return t instanceof h?t.resolve(e):t}},{key:"$priority",get:function(){return this.constructor.$priority}}]),t}(),b=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,g),s(t,[{key:"execute",value:function(t,e,n){var r=n[e+1],i=r instanceof g?this._executeForOperator(r,t):this._executeForConsumer(r,t);null===i?n.splice(e,2):n.splice(e,2,i)}},{key:"_executeForOperator",value:function(){throw new Error("Overwrite this method!")}},{key:"_executeForConsumer",value:function(){throw new Error("Overwrite this method!")}}]),t}();b.$prevMustntBeConsumer=!0;var O=b,C=function(){function e(){return i(this,e),c(this,o(e).call(this))}return n(e,O),s(e,[{key:"_executeForOperator",value:function(t){if(t instanceof e)return new F;if(t instanceof e)return this;throw new Error("Invalid usage of unary negation")}},{key:"_executeForConsumer",value:function(t,e){return-this.resolveSide(t,e)}}]),e}();C.$pattern=/^-/;var F=function(){function e(){return i(this,e),c(this,o(e).call(this))}return n(e,O),s(e,[{key:"_executeForOperator",value:function(t){if(t instanceof e)return this;if(t instanceof C)return new C;throw new Error("Invalid usage of unary plus")}},{key:"_executeForConsumer",value:function(t,e){return+this.resolveSide(t,e)}}]),e}();F.$pattern=/^\+/;var j={Plus:F,Negation:C},I="Invalid usage of three-argument operator",N=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,g),s(t,[{key:"execute",value:function(t,e,n){var r=e-1;if(!(n[e+2]instanceof P))throw new Error(I);var i=this.resolveSide(n[r],t)?this.resolveSide(n[e+1],t):this.resolveSide(n[e+3],t);n.splice(r,5,i)}}]),t}();N.$prevMustBeConsumer=!0,N.$pattern=/^\?/;var P=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,g),s(t,[{key:"execute",value:function(){throw new Error(I)}}]),t}();P.$prevMustBeConsumer=!0,P.$pattern=/^:/;var B={Start:N,End:P},M=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,g),s(t,[{key:"execute",value:function(t,e,n){var r=e-1,i=this._execute(n[r],n[e+1],t);n.splice(r,3,i)}},{key:"_execute",value:function(){throw new Error("Overwrite this method!")}}]),t}();M.$prevMustBeConsumer=!0;var U=M,D=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return(t=this.resolveSide(t,n))[e=this.resolveSide(e,!1)]}}]),t}();D.$pattern=/^\./;var T=D,z=function(){function e(){return i(this,e),c(this,o(e).call(this))}return n(e,O),s(e,[{key:"_executeForOperator",value:function(t){if(t instanceof e)return null;throw new Error("Invalid usage of logical not")}},{key:"_executeForConsumer",value:function(t,e){return!this.resolveSide(t,e)}}]),e}();z.$pattern=/^!(?!=)/;var A=z,Z=function(){function e(){return i(this,e),c(this,o(e).call(this))}return n(e,O),s(e,[{key:"_executeForOperator",value:function(t){if(t instanceof e)return null;throw new Error("Invalid usage of bitwise not")}},{key:"_executeForConsumer",value:function(t,e){return~this.resolveSide(t,e)}}]),e}();Z.$pattern=/^~/;var G=Z,L=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,O),s(t,[{key:"_executeForOperator",value:function(){throw new Error("Invalid usage of typeof")}},{key:"_executeForConsumer",value:function(t,e){return r(this.resolveSide(t,e))}}]),t}();L.$pattern=/^typeof(?![A-Za-z0-9$_])/;var R=L,q=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)*this.resolveSide(e,n)}}]),t}();q.$pattern=/^\*/;var H=q,J=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)/this.resolveSide(e,n)}}]),t}();J.$pattern=/^\//;var K=J,Q=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)%this.resolveSide(e,n)}}]),t}();Q.$pattern=/^%/;var V=Q,W=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)+this.resolveSide(e,n)}}]),t}();W.$pattern=/^\+/;var X=W,Y=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)-this.resolveSide(e,n)}}]),t}();Y.$pattern=/^-/;var tt=Y,et=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)>=this.resolveSide(e,n)}}]),t}();et.$pattern=/^>=/;var nt=et,rt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)<=this.resolveSide(e,n)}}]),t}();rt.$pattern=/^<=/;var it=rt,ut=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)>this.resolveSide(e,n)}}]),t}();ut.$pattern=/^>/;var st=ut,ot=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)<this.resolveSide(e,n)}}]),t}();ot.$pattern=/^</;var at=ot,ct=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)instanceof this.resolveSide(e,n)}}]),t}();ct.$pattern=/^instanceof/;var ht=ct,lt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)in this.resolveSide(e,n)}}]),t}();lt.$pattern=/^in/;var ft=lt,vt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)===this.resolveSide(e,n)}}]),t}();vt.$pattern=/^===/;var dt=vt,pt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)!==this.resolveSide(e,n)}}]),t}();pt.$pattern=/^!==/;var yt=pt,xt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)==this.resolveSide(e,n)}}]),t}();xt.$pattern=/^==/;var kt=xt,wt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)!=this.resolveSide(e,n)}}]),t}();wt.$pattern=/^!=/;var St=wt,_t=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)&&this.resolveSide(e,n)}}]),t}();_t.$pattern=/^&&/;var $t=_t,mt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)||this.resolveSide(e,n)}}]),t}();mt.$pattern=/^\|\|/;var Et=mt,gt=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)&this.resolveSide(e,n)}}]),t}();gt.$pattern=/^&/;var bt=gt,Ot=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)|this.resolveSide(e,n)}}]),t}();Ot.$pattern=/^\|/;var Ct=Ot,Ft=function(){function t(){return i(this,t),c(this,o(t).call(this))}return n(t,U),s(t,[{key:"_execute",value:function(t,e,n){return this.resolveSide(t,n)^this.resolveSide(e,n)}}]),t}();Ft.$pattern=/^\^/;for(var jt=[T,A,G,j.Plus,j.Negation,R,H,K,V,X,tt,nt,it,st,at,ht,ft,dt,yt,kt,St,$t,Et,bt,Ct,Ft,B.Start,B.End],It=0;It<jt.length;It++)jt[It].$priority=jt.length-It;var Nt={find:function(t,e){var n=!0,r=!1,i=void 0;try{for(var u,s=jt[Symbol.iterator]();!(n=(u=s.next()).done);n=!0){var o=u.value;if(o.$pattern.test(t)&&(!o.$prevMustBeConsumer&&!e||!o.$prevMustntBeConsumer&&e))return o}}catch(t){r=!0,i=t}finally{try{n||null==s.return||s.return()}finally{if(r)throw i}}return null},isOperator:function(t){return t instanceof g}},Pt=/\s/,Bt=/\(/,Mt=/\)/,Ut=function(){function n(t,e){if(i(this,n),t instanceof n)this.parent=t;else{if("string"!=typeof t)throw new TypeError("expression is not a String");if("object"!==r(e)||null===e)throw new TypeError("expression is not an Object");this.parent=null,this._expression=t,this._context=e,this._idx=0}}return s(n,[{key:"run",value:function(){return this.entities=[],this.readExpression(),this.execute()}},{key:"readExpression",value:function(){var t,e,n;for(this.currentEntity=null,this.idx;this.idx<this.expression.length;this.idx++){if(t=this.expression[this.idx],null==this.currentEntity){if(Pt.test(t))continue;if(Bt.test(t)){this.evaluateGroup();continue}if(Mt.test(t)){if(null==this.parent)throw new Error("Unexpected group closing char");this.idx++;break}if(null==(n=this.findEntity()))throw new Error("Unexpected char ".concat(t," at index ").concat(this.idx));this.currentEntity=new n}(e=this.currentEntity.take(t))===v?this.resolveEntity():e===l&&(this.resolveEntity(),--this.idx)}null!=this.currentEntity&&this.resolveEntity()}},{key:"execute",value:function(){for(;1<this.entities.length;){for(var t={priority:0,index:-1},e=0;e<this.entities.length;e++)if(Nt.isOperator(this.entities[e])){var n=this.entities[e].$priority;t.priority<n&&(t.priority=n,t.index=e)}this.entities[t.index].execute(this.context,t.index,this.entities)}return E.isConsumer(this.entities[0])&&(this.entities[0]=this.entities[0].resolve(this.context)),this.entities[0]}},{key:"findEntity",value:function(){var t=this.expression.substr(this.idx),e=Nt.find(t,this.isLastEntityConsumer);return null==e&&(e=E.find(t)),e}},{key:"resolveEntity",value:function(){this.entities.push(this.currentEntity),this.currentEntity=null}},{key:"evaluateGroup",value:function(){this.idx++,this.currentEntity=new n(this).run(),this.resolveEntity()}},{key:"expression",get:function(){return null==this.parent?this._expression:this.parent._expression}},{key:"context",get:function(){return null==this.parent?this._context:this.parent._context}},{key:"idx",get:function(){return null==this.parent?this._idx:this.parent._idx},set:function(t){null==this.parent?this._idx=t:this.parent._idx=t}},{key:"isLastEntityConsumer",get:function(){return 0<this.entities.length&&!Nt.isOperator(this.entities[this.entities.length-1])}}]),n}();return function(t){return new Ut(t,1<arguments.length&&void 0!==arguments[1]?arguments[1]:{}).run()}});
